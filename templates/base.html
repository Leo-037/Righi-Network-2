{% load static %}
{% load staticfiles %}
{% load hijack_tags %}
{% load account %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% if title %}RN - {{ title }}{% else %}Righi-Network{% endif %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css"
          integrity="sha256-/Z28yXtfBv/6/alw+yZuODgTbKZm86IKbPE/5kjO/xY=" crossorigin="anonymous"/>
    <link rel="stylesheet" type="text/css" href="{% static 'hijack/hijack-styles.css' %}"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto|Lato|Open+Sans' rel='stylesheet'>
    <script src="{% static 'js/jquery-3.2.1.js' %}"></script>
    {#    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>#}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
    <script>
        window.fbAsyncInit = function () {
            FB.init({
                appId: '1263247960440617',
                cookie: true,
                xfbml: true,
                version: 'v2.8'
            });
            FB.AppEvents.logPageView();
        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 105%;
        }

        .edit {
            display: none;
        }
    </style>
    <script>
        $(document).ready(function () {
            $('.main.sidebar')
                .sidebar('setting', 'transition', 'overlay') // push
                .sidebar('attach events', '#open-main-sidebar')
            ;
            $('.dropdown').dropdown()
            ;
            $('.message .close').on('click', function () {
                $(this).closest('.message').transition('fade');
            })
            ;
            $('.edit-button').on('click', function () {
                $('.edit').toggle();
            })
            ;
            $('.delete-button').on('click', function () {
                var delete_href = $(this).data('href');
                $('#delete-modal')
                    .modal('setting', 'transition', 'fade up')
                    .modal({
                        closable: false,
                        onApprove: function () {
                            window.location = delete_href;
                        }
                    })
                    .modal('show')
            })
            ;
            $('.ui.accordion')
                .accordion()
            ;
            $('.ui.progress')
                .progress("")
            ;
            $('.ui.radio.checkbox')
                .checkbox()
            ;
        })
    </script>

    {% block head_extra %}{% endblock head_extra %}
</head>

<body>

<!-- sidebar -->
<div class="ui main inverted vertical menu sidebar" id="main_sidebar">
    <div class="item">
        <a class="ui logo icon image" href="/" style="margin-right: 1rem" type="image/png">
            <img src="{% static 'righinetwork/r2.png' %}">
        </a>
        <a href="{{ BASE_DIR }}/"><b>Righi-Network</b></a>
    </div>
    {% if user.studente.is_rapistituto or user.is_superuser %}
        <div class="item">
            <div class="header">Gestione</div>
            <div class="menu">
                {% if user.is_superuser %}
                    <a href="{% url "admin:index" %}" class="item">Admin</a>
                {% endif %}
                <a href="{% url "accounts:gestione" %}" class="item">Classi/Studenti</a>
            </div>
        </div>
    {% endif %}
    <a href="{% url "assemblee:all_assemblee" %}" class="item"><b>Assemblee d'istituto</b></a>
    <a href="{% url "sondaggi:index" %}" class="item"><b>Sondaggi</b></a>
</div>

<div class="pusher">

    <!-- menu -->
    <div class="ui fixed inverted evenly divided borderless main menu" id="main_menu">
        <a class="launch icon item" id="open-main-sidebar">
            <i class="content icon"></i>
        </a>

        <a class="active item" href="{{ BASE_DIR }}/">
            Righi-Network
        </a>

        {% if user.is_authenticated %}
            <div class="right borderless menu">
                <div class="vertically fitted item">
                    <div href="#" class="ui dropdown item" id="user-dropdown">
                        {{ user.first_name }} <i class="dropdown icon"></i>
                        <div class="menu">
                            <div class="header">Impostazioni</div>
                            <a class="item" href="{% url 'account_email' %}">E-mail</a>
                            <a class="item" href="{% url 'account_reset_password' %}">Password</a>
                            <a class="item" href="{% url 'socialaccount_connections' %}">Social</a>
                            <div class="divider"></div>
                            <a class="item" href="{% url 'account_logout' %}">Esci</a>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <br><br><br>

    <div class="ui container">

        <!-- notifica hijack -->
        {% if request|is_hijacked %}
            <div class="ui floating yellow tiny message">
                <div class="ui right floated blue header">
                    <a href="{{ BASE_DIR }}/hijack/release-hijack/">Rilascia</a>
                </div>
                <div class="ui header">Hijack di "{{ request.user.username }}"</div>
            </div>
        {% endif %}

        <!-- messaggi -->
        {% for message in messages %}
            <div class="ui green floating message">
                <i class="close icon"></i>
                <div class="header">Messaggio</div>
                <span>{{ message }}</span>
            </div>
        {% endfor %}

        <div class="ui basic clearing segment" style="padding: 0;" id="main_breadcrumb">
            <div class="ui large breadcrumb">
                {% block breadcrumb %}
                {% endblock breadcrumb %}
            </div>
            <div class="ui fitted divider"></div>
            {% if title %}
                <div class="ui large green right floated header" style="margin-right: 0">
                    {{ title }}
                </div>
            {% endif %}
        </div>


        {% block content %}
        {% endblock content %}

        {% block extra_body %}
        {% endblock extra_body %}


        <!-- modal eliminazione -->
        <div class="ui basic animated modal" id="delete-modal">
            <div class="ui icon header">
                <i class="delete icon"></i>
                Eliminare questo elemento?
            </div>
            <div class="content">
                <h3>L'operazione non può essere annullata</h3>
            </div>
            <div class="actions">
                <div class="ui red basic cancel inverted button">
                    <i class="remove icon"></i>
                    Annulla
                </div>
                <div class="ui green ok inverted button">
                    <i class="checkmark icon"></i>
                    Elimina
                </div>
            </div>
        </div>
    </div>
</div>


<!-- TODO: controllare in TUTTI i file .html i controlli se l'utente è admin o rappresentante -->
<!-- TODO: controllare cosa è visibile dai non rappresentanti (es. assemblee.html) -->
<!-- TODO: ripensare i redirect -->
<!-- TODO: controllare e ripensare come viene visualizzata la roba (larghezza delle colonne, etc...) -->
<!-- TODO: aggiungere messaggi dove necessario -->
<!-- TODO: aggiungere filtro per rappresentanti nelle colonne? -->

</body>
</html>
