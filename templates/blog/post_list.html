{% extends "base.html" %}

{% block title %}
    {{ title }}
{% endblock %}

{% block head_extra %}
{% endblock head_extra %}

{% block content %}
    <nav class="breadcrumb">
        <span class="breadcrumb-item active">Home</span>
    </nav>

    <div class="row">
        <div class="col-md-8">
            <h1 class="page-header text-primary">
                {{ title }}
                {#<small>Secondary Text</small>#}
            </h1>
            <hr>
            <div>
                <form onsubmit="window.location = '/?q=' + search.value + '{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}'; return false;">
                    <div class="input-group">
                        <input class="form-control" id="search" placeholder='Cerca post' type="search" name="search"
                               value="" required>
                        <span class="input-group-btn">
				            <button class="btn btn-primary"><i
                                    class="fa fa-search"></i></button>
                        </span>
                        {% if request.GET.q or request.GET.tag %}
                            <span class="input-group-btn">
                            <button type="button" {% if next %}onclick="location.href='{{ next }}';"
                                    {% else %}onclick="location.href='/';"{% endif %} class="btn btn-danger"><i
                                    class="fa fa-close"></i></button>
                        </span>
                        {% endif %}
                    </div>
                </form>
                {% if request.GET.q or request.GET.tag %}
                    <br>
                    <ul>
                        {% if request.GET.q %}
                            <li>
                                <h4 class="text-warning">
                                    <small class="text-muted">Cerca:</small>
                                    {{ request.GET.q|title }}</h4>
                            </li>
                        {% endif %}
                        {% if request.GET.tag %}
                            <li>
                                <h4 class="text-warning">
                                    <small class="text-muted">Tag:</small>
                                    {{ request.GET.tag|title }}</h4>
                            </li>
                        {% endif %}
                    </ul>
                {% endif %}
            </div>
            <hr>

            {% if object_list|length > 0 %}
                {% for post in object_list %}
                    {% url "blog:detail" post.slug as post_url %}
                    <div class="card card-outline-primary mb-4">
                        {% if user.is_superuser or user.studente.is_rapistituto %}
                            <div class="card-header">
                                <h5 class="text-center"><a href="{% url "blog:update" post.slug %}"
                                                           class="text-warning">Modifica</a>
                                    /
                                    <a href="{% url "blog:delete" post.slug %}" class="text-danger">Elimina</a>
                                    {% if post.draft %} / <span class="text-info">Bozza</span>{% endif %}
                                    {% if post.publish > today %}
                                        / <span class="text-info">Post Futuro</span>{% endif %}</h5>
                            </div>
                        {% endif %}
                        {% if post.image %}
                            <img class="card-img-top img-fluid" src="{{ post.image.url }}" alt="Card image cap">
                        {% endif %}
                        <div class="card-block">
                            <h2 class="card-title"><a href="{{ post_url }}">{{ post.title }}</a></h2>
                            <p class="card-text">{{ post.content|truncatewords_html:100|safe }}</p>
                            <hr>
                            <a href="{{ post_url }}" class="btn btn-secondary text-primary">Leggi &rarr;</a>
                        </div>
                        <div class="card-footer text-muted">
                            Postato il {{ post.publish|date:'d-m-Y' }} da <a
                                href="/?q={{ post.user.first_name|lower }}+{{ post.user.last_name|lower }}">{{ post.user.first_name }} {{ post.user.last_name }}</a>
                        </div>
                        {% if post.tags.all|length > 0 %}
                            <div class="card-footer text-muted">
                                Tag: {% for tag in post.tags.all %}
                                <a href="/?tag={{ tag }}">{{ tag }}</a>
                                {% if user.is_superuser or user.studente.is_rapistituto %}
                                    [<a class="text-danger" href="{% url "blog:remove-tag" post.slug tag %}?next=/"><i
                                        class="fa fa-close"></i></a>]{% endif %}
                                {% if forloop.counter < post.tags.all|length %}/{% endif %}
                            {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}

                <!-- Pagination -->
                {% if object_list.has_other_pages %}
                    <div class="row">
                        <div class="col-4">
                            <hr>
                        </div>
                        <ul class="pagination justify-content-center col-4">
                            {% if object_list.has_previous %}
                                <li class="page-item"><a class="page-link"
                                                         href="?page={{ object_list.previous_page_number }}">&laquo;</a>
                                </li>
                            {% else %}
                                <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
                            {% endif %}
                            {% for i in object_list.paginator.page_range %}
                                {% if object_list.number == i %}
                                    <li class="page-item active"><span class="page-link">{{ i }} <span
                                            class="sr-only">(corrente)</span></span></li>
                                {% else %}
                                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}
                            {% if object_list.has_next %}
                                <li class="page-item"><a class="page-link"
                                                         href="?page={{ object_list.next_page_number }}">&raquo;</a>
                                </li>
                            {% else %}
                                <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
                            {% endif %}
                        </ul>
                        <div class="col-4">
                            <hr>
                        </div>
                    </div>
                {% endif %}

            {% else %}
                {% if not user.studente.is_rapistituto and not user.is_superuser %}
                    <hr>
                {% endif %}
                <h2 class="text-center text-warning"><i>Non ci sono comunicazioni</i></h2>

            {% endif %}
        </div>

        <!-- Sidebar Widgets Column -->
        <div class="col-md-4">

            <!-- Edit Widget -->
            {% if user.studente.is_rapistituto or user.is_superuser %}
                <div class="card my-4">
                    <h5 class="card-header">Post</h5>
                    <div class="card-block">
                        <a href="{% url 'blog:create' %}" class="btn btn-primary btn-block"
                        >Aggiungi</a>
                    </div>
                </div>
            {% endif %}

            <!-- Tag Widget -->
            {% if tags|length > 0 %}
                <div class="card my-4">
                    <h5 class="card-header">Tag</h5>
                    <div class="card-block">
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    {% for tag in tags %}
                                        {% if not forloop.counter|divisibleby:2 %}
                                            <li>
                                                <a href="/?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}tag={{ tag }}">{{ tag }}</a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    {% for tag in tags %}
                                        {% if forloop.counter|divisibleby:2 %}
                                            <li>
                                                <a href="/?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}tag={{ tag }}">{{ tag }}</a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            {#            <!-- Side Widget -->#}
            {#            <div class="card my-4">#}
            {#                <h5 class="card-header"></h5>#}
            {#                <div class="card-block">#}
            {#                </div>#}
            {#            </div>#}

        </div>
    </div>
{% endblock %}